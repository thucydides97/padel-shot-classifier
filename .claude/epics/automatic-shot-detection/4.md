---
name: Implement boundary refinement
status: closed
created: 2025-11-22T21:39:47Z
updated: 2025-11-23T10:36:17Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: Implement boundary refinement

## Description
Refine the rough overhead windows into precise shot boundaries by analyzing wrist velocity peaks to find the contact point, then expanding backward/forward to find the true start (arm raising) and end (follow-through) frames.

## Acceptance Criteria
- [ ] Find velocity peak within each window (contact point)
- [ ] Expand backward to find start frame (velocity begins increasing)
- [ ] Expand forward to find end frame (velocity returns to baseline)
- [ ] Use elbow angle as secondary signal for refinement
- [ ] Handle cases with multiple velocity peaks in one window
- [ ] Boundary accuracy within Â±10 frames of ground truth

## Technical Details
- Use scipy.signal.find_peaks for velocity peak detection
- Define start as frame where velocity begins rising above baseline
- Define end as frame where velocity drops back to baseline
- Baseline = mean velocity during non-shot periods
- Use configurable peak prominence threshold

**Algorithm:**
```python
for window in windows:
    velocity_segment = wrist_velocity[window.start:window.end]
    peaks = find_peaks(velocity_segment, prominence=threshold)
    contact = peaks[np.argmax(velocity_segment[peaks])]
    start = find_rising_edge(velocity_segment, contact)
    end = find_falling_edge(velocity_segment, contact)
```

**Files affected:**
- src/padel_shot_classifier/shot_detector.py

## Dependencies
- [ ] Task 001 - Signal utilities
- [ ] Task 002 - Overhead window detection

## Effort Estimate
- Size: M
- Hours: 4-6
- Parallel: false

## Definition of Done
- [ ] Boundary refinement algorithm implemented
- [ ] Unit tests for refinement functions
- [ ] Boundary accuracy validated on test data
- [ ] Edge cases handled (weak signals, multiple peaks)
