---
name: Implement CSV output generation
status: open
created: 2025-11-22T21:39:47Z
updated: 2025-11-22T21:39:47Z
github: [Will be updated when synced to GitHub]
depends_on: [004]
parallel: false
conflicts_with: []
---

# Task: Implement CSV output generation

## Description
Generate CSV output compatible with the existing classification pipeline (shots.csv format) while including additional columns for confidence scores and flags.

## Acceptance Criteria
- [ ] Output matches format: shot_type,start_frame,end_frame
- [ ] Add confidence column for detection confidence
- [ ] Add type_confidence column for classification confidence
- [ ] Add flagged column for low-confidence warnings
- [ ] Existing pipeline works with extended CSV (ignores extra columns)
- [ ] Option to output minimal format (3 columns only)

## Technical Details
**Output format (extended):**
```csv
shot_type,start_frame,end_frame,confidence,type_confidence,flagged
bandeja,120,185,0.92,0.78,false
unknown,245,310,0.65,0.34,true
smash,410,475,0.88,0.91,false
```

**Compatibility:**
- Pandas read_csv with usecols=[0,1,2] should work for existing pipeline
- Header row included
- Sorted by start_frame

```python
def to_csv(shots, output_path, minimal=False):
    df = pd.DataFrame([{
        'shot_type': s.type,
        'start_frame': s.start,
        'end_frame': s.end,
        'confidence': s.confidence,
        'type_confidence': s.type_confidence,
        'flagged': s.confidence < threshold
    } for s in shots])

    if minimal:
        df = df[['shot_type', 'start_frame', 'end_frame']]

    df.to_csv(output_path, index=False)
```

**Files affected:**
- src/padel_shot_classifier/shot_detector.py

## Dependencies
- [ ] Task 004 - Confidence scoring

## Effort Estimate
- Size: S
- Hours: 2-3
- Parallel: false

## Definition of Done
- [ ] CSV output generation implemented
- [ ] Output compatible with existing pipeline
- [ ] Minimal format option works
- [ ] Unit tests for CSV generation
